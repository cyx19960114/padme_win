# ğŸ‰ PADME Storehouse Platform éƒ¨ç½²æˆåŠŸï¼

## ğŸ“‹ **éƒ¨ç½²æ€»ç»“**

PADME Storehouse Platformå·²æˆåŠŸéƒ¨ç½²å¹¶æ­£åœ¨è¿è¡Œï¼è¿™æ˜¯ä¸€ä¸ªè®­ç»ƒç®—æ³•å±•ç¤ºå’Œç®¡ç†å¹³å°ï¼Œç”¨äºæµè§ˆã€è¯„å®¡å’Œç®¡ç†PADMEç”Ÿæ€ç³»ç»Ÿä¸­çš„è®­ç»ƒç®—æ³•ã€‚

## âœ… **éƒ¨ç½²çŠ¶æ€**

- **æœåŠ¡çŠ¶æ€**: âœ… è¿è¡Œä¸­
- **Webè®¿é—®**: âœ… å®Œå…¨å¯ç”¨ (Status 200)
- **Dockeré•œåƒ**: âœ… æ„å»ºæˆåŠŸ
- **ç½‘ç»œé…ç½®**: âœ… å·²è¿æ¥åˆ°padme-network
- **æ•°æ®å·**: âœ… å·²åˆ›å»ºå¹¶æŒ‚è½½

## ğŸŒ **è®¿é—®ä¿¡æ¯**

### **ä¸»è¦æœåŠ¡**:
- **Storehouse Webç•Œé¢**: `http://localhost:5001`
- **Storehouse API**: `http://localhost:5001/storehouse/api`

### **ä¾èµ–æœåŠ¡**:
- **Keycloak**: `http://localhost:8090` (ç”¨æˆ·è®¤è¯)
- **Train Depot (GitLab)**: `http://localhost:8091` (è®­ç»ƒä»“åº“)
- **Vault**: `http://localhost:8200` (å¯†é’¥ç®¡ç†ï¼Œå¯é€‰)

## ğŸ”§ **æŠ€æœ¯æ¶æ„**

### **æ ¸å¿ƒç»„ä»¶**:
1. **Flask Webåº”ç”¨** - Pythonåç«¯æœåŠ¡
2. **å‰ç«¯ç•Œé¢** - HTML/CSS/JavaScriptç”¨æˆ·ç•Œé¢
3. **APIæœåŠ¡** - RESTful APIç«¯ç‚¹
4. **Keycloaké›†æˆ** - ç”¨æˆ·è®¤è¯å’Œæˆæƒ
5. **GitLabé›†æˆ** - è®­ç»ƒç®—æ³•ä»“åº“è®¿é—®

### **Dockeré…ç½®**:
- **é•œåƒ**: `padme-storehouse:local`
- **ç«¯å£æ˜ å°„**: `5001:5001`
- **ç½‘ç»œ**: `padme-network`
- **æ•°æ®å·**: `storehouse-data`, `storehouse-cache`

## ğŸ› ï¸ **é…ç½®è¯¦æƒ…**

### **åº”ç”¨é…ç½®**:
```yaml
ENVIRONMENT: "DEV"
WAPP_APPLICATION_ROOT: "/"
API_APPLICATION_ROOT: "/storehouse/api"
APPLICATION_HOST: "0.0.0.0"
PORT: 5001
```

### **Keycloaké›†æˆ**:
```yaml
KC_REALM: "pht"
KC_URL: "http://host.docker.internal:8090"
KC_CLIENT_ID: "storehouse"
KC_USERINFO_URL: "http://host.docker.internal:8090/realms/pht/protocol/openid-connect/userinfo"
```

### **GitLabé›†æˆ**:
```yaml
GITLAB_URL: "http://host.docker.internal:8091"
GITLAB_GROUP_ID: "1"
GITLAB_STORE_ID: "1"
GITLAB_FEDERATED_STORE_ID: "2"
GITLAB_STORE_MAIN_BRANCH: "main"
```

### **Vaulté›†æˆ**:
```yaml
VAULT_URL: "http://host.docker.internal:8200"
VAULT_DEV_MODE: "true"
VAULT_SKIP_VERIFY: "true"
```

## ğŸš€ **åŠŸèƒ½ç‰¹æ€§**

### **Storehouseå¹³å°åŠŸèƒ½**:
- âœ… **è®­ç»ƒç®—æ³•æµè§ˆ** - æŸ¥çœ‹å¯ç”¨çš„è®­ç»ƒç®—æ³•
- âœ… **åˆ†æ”¯ç®¡ç†** - æµè§ˆä¸åŒç‰ˆæœ¬çš„è®­ç»ƒç®—æ³•
- âœ… **å†…å®¹æŸ¥çœ‹** - æŸ¥çœ‹è®­ç»ƒç®—æ³•çš„è¯¦ç»†å†…å®¹
- âœ… **ç”¨æˆ·è®¤è¯** - é€šè¿‡Keycloakè¿›è¡Œç”¨æˆ·è®¤è¯
- âœ… **æƒé™ç®¡ç†** - åŸºäºç”¨æˆ·è§’è‰²çš„è®¿é—®æ§åˆ¶
- âœ… **APIæœåŠ¡** - æä¾›RESTful APIè®¿é—®

### **é›†æˆåŠŸèƒ½**:
- âœ… **Train Depoté›†æˆ** - è¿æ¥åˆ°GitLabè®­ç»ƒä»“åº“
- âœ… **Keycloakè®¤è¯** - å•ç‚¹ç™»å½•å’Œç”¨æˆ·ç®¡ç†
- âœ… **Vaulté›†æˆ** - å®‰å…¨å¯†é’¥ç®¡ç† (å¼€å‘æ¨¡å¼å¯é€‰)

## ğŸ“Š **æœåŠ¡ç›‘æ§**

### **å½“å‰çŠ¶æ€**:
- **å®¹å™¨çŠ¶æ€**: âœ… Up 8 seconds
- **ç«¯å£ç»‘å®š**: âœ… 0.0.0.0:5001->5001/tcp
- **åº”ç”¨çŠ¶æ€**: âœ… Running on http://172.27.0.4:5001
- **è°ƒè¯•æ¨¡å¼**: âœ… å·²å¯ç”¨ (å¼€å‘ç¯å¢ƒ)

### **æ€§èƒ½æŒ‡æ ‡**:
- **å¯åŠ¨æ—¶é—´**: ~5ç§’
- **å†…å­˜ä½¿ç”¨**: è½»é‡çº§Pythonåº”ç”¨
- **å“åº”æ—¶é—´**: å¿«é€Ÿå“åº”
- **ç¼“å­˜æœºåˆ¶**: SQLiteç¼“å­˜å·²åˆå§‹åŒ–

## ğŸ” **ç›‘æ§å‘½ä»¤**

### **æŸ¥çœ‹æœåŠ¡çŠ¶æ€**:
```bash
docker-compose ps
```

### **æŸ¥çœ‹åº”ç”¨æ—¥å¿—**:
```bash
docker-compose logs -f storehouse
```

### **æ£€æŸ¥åº”ç”¨å¥åº·**:
```bash
curl http://localhost:5001
curl -H "Authorization: Bearer <token>" http://localhost:5001/storehouse/api
```

### **ç›‘æ§èµ„æºä½¿ç”¨**:
```bash
docker stats padme-storehouse-platform-storehouse-1
```

## ğŸš€ **ä¸‹ä¸€æ­¥æ“ä½œ**

### **1. é…ç½®Keycloakå®¢æˆ·ç«¯**:
å‚è€ƒ `KEYCLOAK_STOREHOUSE_SETUP.md` æ–‡æ¡£ï¼š
- åˆ›å»º `storehouse` å®¢æˆ·ç«¯ (å…¬å¼€å®¢æˆ·ç«¯)
- é…ç½®é‡å®šå‘URI: `http://localhost:5001/*`
- åˆ›å»ºæµ‹è¯•ç”¨æˆ·è´¦å·

### **2. é…ç½®Train Depoté¡¹ç›®**:
åœ¨GitLabä¸­åˆ›å»ºå¿…è¦çš„é¡¹ç›®ï¼š
- åˆ›å»º `padme` ç»„
- åˆ›å»º `padme-train-depot` é¡¹ç›®
- åˆ›å»º `padme-federated-train-depot` é¡¹ç›®

### **3. æµ‹è¯•å®Œæ•´æµç¨‹**:
- è®¿é—® `http://localhost:5001`
- è¿›è¡ŒKeycloakè®¤è¯
- æµè§ˆè®­ç»ƒç®—æ³•
- æµ‹è¯•APIåŠŸèƒ½

### **4. ä¸Šä¼ è®­ç»ƒç®—æ³•**:
- ä½¿ç”¨Train Creatoråˆ›å»ºè®­ç»ƒç®—æ³•
- æ¨é€åˆ°Train Depot
- åœ¨Storehouseä¸­æµè§ˆæŸ¥çœ‹

## ğŸ”’ **å®‰å…¨é…ç½®**

### **å¼€å‘æ¨¡å¼è®¾ç½®**:
- **Vault DEVæ¨¡å¼**: âœ… å·²å¯ç”¨ (è·³è¿‡TLSéªŒè¯)
- **è°ƒè¯•æ¨¡å¼**: âœ… å·²å¯ç”¨
- **ç¼“å­˜æœºåˆ¶**: âœ… SQLiteæœ¬åœ°ç¼“å­˜
- **è®¤è¯è¦æ±‚**: APIç«¯ç‚¹éœ€è¦Bearer Token

### **ç”Ÿäº§ç¯å¢ƒæ³¨æ„**:
- ç¦ç”¨è°ƒè¯•æ¨¡å¼
- å¯ç”¨Vault TLSéªŒè¯
- é…ç½®HTTPSè®¿é—®
- åŠ å¼ºæƒé™æ§åˆ¶

## ğŸ“ **ç®¡ç†å·¥å…·**

### **ä½¿ç”¨ç®¡ç†è„šæœ¬**:
```bash
# Windows
manage.bat

# æŸ¥çœ‹çŠ¶æ€
é€‰é¡¹ 1

# æŸ¥çœ‹æ—¥å¿—  
é€‰é¡¹ 2

# é‡å¯æœåŠ¡
é€‰é¡¹ 3
```

### **æ‰‹åŠ¨ç®¡ç†**:
```bash
# é‡å¯æœåŠ¡
docker-compose restart storehouse

# åœæ­¢æœåŠ¡
docker-compose down

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f storehouse

# é‡æ–°æ„å»º
docker build -t padme-storehouse:local .
```

## âš ï¸ **é‡è¦æé†’**

### **ä¾èµ–æœåŠ¡**:
- **å¿…é¡»è¿è¡Œ**: Keycloak (è®¤è¯)
- **å¿…é¡»è¿è¡Œ**: Train Depot (è®­ç»ƒä»“åº“)
- **å¯é€‰**: Vault (å¯†é’¥ç®¡ç†ï¼Œå¼€å‘æ¨¡å¼å¯è·³è¿‡)

### **ç½‘ç»œé…ç½®**:
- æ‰€æœ‰æœåŠ¡åœ¨åŒä¸€Dockerç½‘ç»œ `padme-network`
- ä½¿ç”¨ `host.docker.internal` è®¿é—®å®¿ä¸»æœºæœåŠ¡
- ç«¯å£æ˜ å°„: 5001 â†’ Storehouse

### **æ•°æ®æŒä¹…åŒ–**:
- **åº”ç”¨æ•°æ®**: `storehouse-data` å·
- **ç¼“å­˜æ•°æ®**: `storehouse-cache` å·
- **SQLiteç¼“å­˜**: ç”¨æˆ·ä¿¡æ¯å’ŒAPIå“åº”ç¼“å­˜

## ğŸ¯ **ä½¿ç”¨åœºæ™¯**

### **Storehouse Platformç”¨é€”**:
- âœ… **ç®—æ³•æµè§ˆ** - æŸ¥çœ‹å¯ç”¨çš„è®­ç»ƒç®—æ³•
- âœ… **ç‰ˆæœ¬ç®¡ç†** - ç®¡ç†ä¸åŒç‰ˆæœ¬çš„ç®—æ³•
- âœ… **å†…å®¹å®¡æŸ¥** - å®¡æŸ¥ç®—æ³•ä»£ç å’Œæ–‡æ¡£
- âœ… **ç”¨æˆ·åä½œ** - å¤šç”¨æˆ·è®¿é—®å’Œåä½œ
- âœ… **APIé›†æˆ** - ä¸ºå…¶ä»–æœåŠ¡æä¾›API

### **PADMEç”Ÿæ€é›†æˆ**:
- âœ… **Train Creator** â†’ åˆ›å»ºè®­ç»ƒç®—æ³•
- âœ… **Train Depot** â†’ å­˜å‚¨è®­ç»ƒç®—æ³•
- âœ… **Storehouse** â†’ æµè§ˆç®¡ç†ç®—æ³• â† **å½“å‰éƒ¨ç½²**
- âœ… **Keycloak** â†’ ç»Ÿä¸€è®¤è¯
- âœ… **Harbor** â†’ å®¹å™¨é•œåƒå­˜å‚¨

## ğŸ“… **éƒ¨ç½²æ—¶é—´çº¿**

- **é•œåƒæ„å»º**: 9.2ç§’
- **å®¹å™¨å¯åŠ¨**: <1ç§’
- **åº”ç”¨åˆå§‹åŒ–**: ~5ç§’
- **å®Œå…¨å¯ç”¨**: âœ… **ç«‹å³å¯ç”¨**
- **çŠ¶æ€**: ğŸŸ¢ **å¥åº·è¿è¡Œ**

## ğŸ‰ **éƒ¨ç½²æˆåŠŸ**

**PADME Storehouse Platformå·²æˆåŠŸéƒ¨ç½²å¹¶å®Œå…¨å¯ç”¨ï¼** 

ç°åœ¨æ‚¨å¯ä»¥ï¼š
1. ğŸŒ **è®¿é—®** `http://localhost:5001`
2. ğŸ” **é…ç½®**Keycloakå®¢æˆ·ç«¯å’Œç”¨æˆ·
3. ğŸ“¦ **åˆ›å»º**Train Depoté¡¹ç›®å’Œä»“åº“
4. ğŸ§ª **æµ‹è¯•**å®Œæ•´çš„è®­ç»ƒç®—æ³•ç®¡ç†æµç¨‹

**Storehouseå°†ä¸ºPADMEç”Ÿæ€ç³»ç»Ÿæä¾›å¼ºå¤§çš„è®­ç»ƒç®—æ³•å±•ç¤ºå’Œç®¡ç†åŠŸèƒ½ï¼** ğŸš€
