version: '3.5'

services:
  traincreator:
    build: 
      context: .
    container_name: traincreator-$USER
    entrypoint: ["/bin/sh", "-c", "while sleep 1000; do :; done"]
    restart: unless-stopped
    environment:
      VIRTUAL_HOST: "klee.informatik.rwth-aachen.de"
      VIRTUAL_PORT: 5000
      VIRTUAL_PATH: "/traincreator-$USER"
      WAPP_APPLICATION_ROOT: "/traincreator-$USER/"
      API_APPLICATION_ROOT: "/traincreator-$USER/api"
      VAULT_URL: "https://vault:8200"
      VAULT_ROLE_ID: ${VAULT_ROLE_ID}
      VAULT_SECRET_ID: ${VAULT_SECRET_ID}
      GITLAB_URL: "https://depot.padme-analytics.de"
      ENVIRONMENT: DEV
      KC_REALM: "pht"
      KC_URL: "https://auth.padme-analytics.de/auth"
      KC_CLIENT_ID: "train-creator"
      KC_USERINFO_URL: "https://auth.padme-analytics.de/auth/realms/pht/protocol/openid-connect/userinfo"
      GITLAB_GROUP_ID: 39
      GITLAB_STORE_ID: 35
      GITLAB_STORE_URL: "https://depot.padme-analytics.de/padme/padme-train-depot"
      GITLAB_STORE_MAIN_BRANCH: "main"
      GITLAB_FEDERATED_STORE_ID: 36
      GITLAB_FEDERATED_STORE_URL: "https://depot.padme-analytics.de/padme/padme-federated-train-depot"
    volumes:
      - vault-certs-client:/usr/src/app/certs:ro
      - "./:/usr/src/app:cached"
    networks:
      proxynet:
      vaultnet:

volumes:
  vault-certs-client:
    external: true

networks:
  vaultnet:
    external: true
  proxynet:
    external: true