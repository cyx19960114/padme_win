<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHT Station Setup Wizard</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .wizard-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            max-width: 800px;
            width: 100%;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        .step {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 5px solid #007bff;
        }
        .step h3 {
            color: #495057;
            margin-top: 0;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007bff;
        }
        .btn {
            background: #007bff;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            margin: 10px 5px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .status {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .current-config {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .progress {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin: 20px 0;
            overflow: hidden;
        }
        .progress-bar {
            background: #007bff;
            height: 100%;
            width: 25%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="wizard-container">
        <h1>🧙‍♂️ PHT Station Setup Wizard</h1>
        
        <div class="progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>

        <div id="currentStep">
            <div class="step">
                <h3>🚀 欢迎使用 PHT Station Software</h3>
                <p>这是 PADME Station Software 的初始化配置向导。我们将引导您完成基本配置。</p>
                
                <div class="status">
                    <strong>✅ 检测到以下服务：</strong><br>
                    • MongoDB: 运行中<br>
                    • Docker-in-Docker: 运行中<br>
                    • Vault: 运行中<br>
                    • Metadata服务: 运行中
                </div>

                <div class="form-group">
                    <label for="stationName">Station 名称:</label>
                    <input type="text" id="stationName" value="Local PHT Station" placeholder="请输入Station名称">
                </div>

                <div class="form-group">
                    <label for="organizationName">组织名称:</label>
                    <input type="text" id="organizationName" value="Local Development" placeholder="请输入组织名称">
                </div>

                <button class="btn" onclick="nextStep()">下一步 →</button>
            </div>
        </div>

        <div id="step2" style="display: none;">
            <div class="step">
                <h3>🔐 Keycloak 认证配置</h3>
                <p>配置与 Keycloak 身份认证服务的连接。</p>

                <div class="form-group">
                    <label for="keycloakUrl">Keycloak 服务器地址:</label>
                    <input type="url" id="keycloakUrl" value="http://localhost:8090" placeholder="http://localhost:8090">
                </div>

                <div class="form-group">
                    <label for="realm">Realm:</label>
                    <input type="text" id="realm" value="pht" placeholder="pht">
                </div>

                <div class="form-group">
                    <label for="clientId">客户端 ID:</label>
                    <input type="text" id="clientId" value="pht-station" placeholder="pht-station">
                </div>

                <button class="btn" onclick="prevStep()">← 上一步</button>
                <button class="btn" onclick="nextStep()">下一步 →</button>
            </div>
        </div>

        <div id="step3" style="display: none;">
            <div class="step">
                <h3>🐳 Docker 配置</h3>
                <p>配置 Docker-in-Docker 连接和容器管理设置。</p>

                <div class="form-group">
                    <label for="dockerHost">Docker 主机:</label>
                    <input type="text" id="dockerHost" value="pht-dind" placeholder="pht-dind">
                </div>

                <div class="form-group">
                    <label for="dockerPort">Docker 端口:</label>
                    <input type="number" id="dockerPort" value="2376" placeholder="2376">
                </div>

                <div class="form-group">
                    <label for="registryUrl">镜像仓库地址:</label>
                    <input type="url" id="registryUrl" value="http://localhost:8080" placeholder="Harbor地址">
                </div>

                <button class="btn" onclick="prevStep()">← 上一步</button>
                <button class="btn" onclick="nextStep()">下一步 →</button>
            </div>
        </div>

        <div id="step4" style="display: none;">
            <div class="step">
                <h3>📋 配置确认</h3>
                <p>请确认以下配置信息：</p>

                <div class="current-config" id="configSummary">
                    <!-- 配置摘要将在这里显示 -->
                </div>

                <div class="status">
                    <strong>⚠️ 注意：</strong> 点击"完成配置"后，系统将应用这些设置并重启 Station Software。
                </div>

                <button class="btn" onclick="prevStep()">← 上一步</button>
                <button class="btn btn-success" onclick="finishSetup()">✅ 完成配置</button>
            </div>
        </div>

        <div id="completedStep" style="display: none;">
            <div class="step">
                <h3>🎉 配置完成！</h3>
                <div class="status">
                    <strong>✅ PHT Station Software 配置成功！</strong><br>
                    系统正在重启以应用新配置...
                </div>
                
                <div class="current-config">
                    <strong>下一步操作：</strong><br>
                    1. 系统将自动重启<br>
                    2. 重启后将显示主界面<br>
                    3. 使用 Keycloak 用户登录<br>
                    4. 开始使用 Station 功能
                </div>

                <p>页面将在 <span id="countdown">5</span> 秒后自动刷新...</p>
            </div>
        </div>
    </div>

    <script>
        let currentStepIndex = 1;
        const totalSteps = 4;

        function updateProgress() {
            const progressBar = document.getElementById('progressBar');
            const progress = (currentStepIndex / totalSteps) * 100;
            progressBar.style.width = progress + '%';
        }

        function showStep(stepIndex) {
            // 隐藏所有步骤
            document.getElementById('currentStep').style.display = 'none';
            document.getElementById('step2').style.display = 'none';
            document.getElementById('step3').style.display = 'none';
            document.getElementById('step4').style.display = 'none';
            document.getElementById('completedStep').style.display = 'none';

            // 显示当前步骤
            if (stepIndex === 1) {
                document.getElementById('currentStep').style.display = 'block';
            } else if (stepIndex === 2) {
                document.getElementById('step2').style.display = 'block';
            } else if (stepIndex === 3) {
                document.getElementById('step3').style.display = 'block';
            } else if (stepIndex === 4) {
                document.getElementById('step4').style.display = 'block';
                updateConfigSummary();
            } else if (stepIndex === 5) {
                document.getElementById('completedStep').style.display = 'block';
                startCountdown();
            }

            updateProgress();
        }

        function nextStep() {
            if (currentStepIndex < totalSteps + 1) {
                currentStepIndex++;
                showStep(currentStepIndex);
            }
        }

        function prevStep() {
            if (currentStepIndex > 1) {
                currentStepIndex--;
                showStep(currentStepIndex);
            }
        }

        function updateConfigSummary() {
            const config = {
                stationName: document.getElementById('stationName').value,
                organizationName: document.getElementById('organizationName').value,
                keycloakUrl: document.getElementById('keycloakUrl').value,
                realm: document.getElementById('realm').value,
                clientId: document.getElementById('clientId').value,
                dockerHost: document.getElementById('dockerHost').value,
                dockerPort: document.getElementById('dockerPort').value,
                registryUrl: document.getElementById('registryUrl').value
            };

            const summary = `
Station 名称: ${config.stationName}
组织名称: ${config.organizationName}

Keycloak 配置:
- 服务器: ${config.keycloakUrl}
- Realm: ${config.realm}
- 客户端ID: ${config.clientId}

Docker 配置:
- 主机: ${config.dockerHost}
- 端口: ${config.dockerPort}
- 镜像仓库: ${config.registryUrl}
            `;

            document.getElementById('configSummary').innerText = summary;
        }

        function finishSetup() {
            // 收集配置数据
            const configData = {
                stationName: document.getElementById('stationName').value,
                organizationName: document.getElementById('organizationName').value,
                keycloakUrl: document.getElementById('keycloakUrl').value,
                realm: document.getElementById('realm').value,
                clientId: document.getElementById('clientId').value,
                dockerHost: document.getElementById('dockerHost').value,
                dockerPort: document.getElementById('dockerPort').value,
                registryUrl: document.getElementById('registryUrl').value
            };

            // 发送配置到后端
            fetch('/setup/complete', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(configData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('配置成功:', data);
                currentStepIndex = 5;
                showStep(currentStepIndex);
            })
            .catch(error => {
                console.error('配置失败:', error);
                alert('配置失败，请重试');
            });
        }

        function startCountdown() {
            let count = 5;
            const countdownElement = document.getElementById('countdown');
            
            const timer = setInterval(() => {
                count--;
                countdownElement.textContent = count;
                
                if (count <= 0) {
                    clearInterval(timer);
                    window.location.reload();
                }
            }, 1000);
        }

        // 初始化
        updateProgress();
    </script>
</body>
</html>
